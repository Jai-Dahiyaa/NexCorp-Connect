pipeline {
  agent any
  

  stages {
    stage ('Checkout Code') {
      steps {
        echo "Checking out code..."
        checkout scm
      }
    }

    stage ('install Dependencies') {
      steps {
        echo "Running npm install..."
        dir('backend') {
          sh 'npm ci'
        }
      }
    }

    // stage ('Run Test') {
    //   steps {
    //     echo "Running npm test..."
    //     dir('backend') {
    //       sh 'npm test'
    //     }
    //   }
    // }

    stage ('Build Docker Image') {
      steps {
        sh 'docker build -t skillbrodge_app'
      }
    }

    stage ('Deploy') {
      steps {
        sh '''
                docker compose down
                docker compose up -d --build
                '''
      }
    }

  }

  post {
    success {
      echo "Build and run successfull"
    } 
    failure {
      echo "Build faild. Check logs"
    }
  }
}