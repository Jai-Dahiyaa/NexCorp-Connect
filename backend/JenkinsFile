pipeline {
  agent any

  environment {
    POSTGRES_HOST = 'localhost'
    POSTGRES_USER = 'postgres'
    POSTGRES_PASSWORD = '87&62@'
    POSTGRES_DB = 'issuelog'
    REDIS_URL = 'redis://127.0.0.1:6379'
  }

  stages {
    stage ('Checkout Code') {
      steps {
        echo "Checking out code..."
        checkout scm
      }
    }

    stage ('install Dependencies') {
      steps {
        echo "Running npm install..."
        dir('backend') {
          sh 'npm ci'
        }
      }
    }

    stage ('Run Test') {
      steps {
        echo "Running npm test..."
        dir('backend') {
          sh 'npm test'
        }
      }
    }

    stage ('Start Project') {
      steps {
        echo "Starting project..."
        dir('backend') {
          sh 'npm run dev'
        }
      }
    }
  }

  post {
    success {
      echo "Build and run successfull"
    } 
    failure {
      echo "Build faild. Check logs"
    }
  }
}